---
title: Test-CsP2PAV
TOCTitle: Test-CsP2PAV
ms:assetid: acb01fb7-4685-4f38-a724-8c2ae8e0219a
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Gg412821(v=OCS.15)
ms:contentKeyID: 49310827
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Test-CsP2PAV

 

_**Дата изменения раздела:** 2015-03-09_

Проверяет возможность проведения однорангового аудио-видео вызова. Данный командлет впервые появился в Lync Server 2010.

## Синтаксис

    Test-CsP2PAV -ReceiverCredential <PSCredential> -ReceiverSipAddress <String> -SenderCredential <PSCredential> -SenderSipAddress <String> [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] [-RegistrarPort <Int32>] [-TargetFqdn <String>] <COMMON PARAMETERS>

    Test-CsP2PAV -TargetFqdn <String> [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] [-ReceiverSipAddress <String>] [-RegistrarPort <Int32>] [-SenderSipAddress <String>] <COMMON PARAMETERS>

    Test-CsP2PAV [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] <COMMON PARAMETERS>

    COMMON PARAMETERS: [-Force <SwitchParameter>] [-OutLoggerVariable <String>] [-OutVerboseVariable <String>]

## Примеры

## ПРИМЕР 1

Пример 1 проверяет, может ли пара предварительно настроенных тестовых пользователей войти в пул atl-cs-001.litwareinc.com и выполнить одноранговый аудио-видео вызов. Эта команда будет работать, только если в пуле atl-cs-001.litwareinc.com определены тестовые пользователи. Если это так, команда определит, могут ли два пользователя войти в систему и, если это так, могут ли они общаться с помощью аудио-видео вызова.

Если тестовые пользователи не были определены, команда завершится с ошибкой, так как она не будет знать, каких пользователей применять в тесте. Если вы не определили тестовых пользователей для пула, укажите параметры SenderSipAddress и ReceiverSipAddress, а также соответствующие учетные данные для пользователей, участвующих в сеансе обмена мгновенными сообщениями. Затем **Test-CsP2PAV** выполнит проверки с применением указанных пользователей.

    Test-CsP2PAV -TargetFqdn atl-cs-001.litwareinc.com 

## ПРИМЕР 2

Команды, показанные в примере 2, проверяют возможность двух пользователей (litwareinc\\pilar и litwareinc\\kenmyer) входить в Lync Server и осуществлять одноранговый аудио-видео вызов. Для этого первая команда в примере использует командлет **Get-Credential** для создания объекта учетных данных Windows PowerShell, содержащего имя и пароль пользователя Pilar Ackerman. (Так как имя пользователя litwareinc\\pilar указано как параметр, в диалоговом окне запроса учетных данных Windows PowerShell требуется ввести только пароль для учетной записи пользователя Pilar Ackerman.) Полученный объект учетных данных затем сохраняется в переменной $cred1. Вторая команда делает то же самое, но на этот раз возвращает объект учетных данных для пользователя Ken Myer.

После получения двух объектов учетных данных третья команда в примере определяет, могут ли два пользователя войти в Lync Server и осуществить одноранговый аудио-видео вызов. Для выполнения этой задачи вызывается **Test-CsP2PAV** со следующими параметрами: TargetFqdn (полное доменное имя пула службы регистратора), SenderSipAddress (SIP-адрес первого тестового пользователя), SenderCredential (объект Windows PowerShell с учетными данными для того же пользователя), ReceiverSipAddress (SIP-адрес другого тестового пользователя), ReceiverCredential (объект Windows PowerShell с учетными данными другого пользователя).

    $cred1 = Get-Credential "litwareinc\pilar"
    $cred2 = Get-Credential "litwareinc\kenmyer"
    
    Test-CsP2PAV -TargetFqdn atl-cs-001.litwareinc.com -SenderSipAddress "sip:pilar@litwareinc.com" -SenderCredential $cred1 -ReceiverSipAddress "sip:kenmyer@litwareinc.com" -ReceiverCredential $cred2

## Подробное описание

**Test-CsP2PAV** представляет собой пример "искусственной транзакции" Lync Server. Искусственные транзакции используются в Lync Server для проверки того, что пользователи смогут успешно выполнять обычные задачи, такие как вход в систему, обмен мгновенными сообщениями или звонок на телефон, находящийся в телефонной сети общего пользования (PSTN). Эти тесты могут проводиться как вручную администратором, так и автоматически, такими приложениями, как Microsoft System Center Operations Manager (ранее Microsoft Operations Manager).

Искусственные транзакции обычно выполняются двумя разными способами. Многие администраторы используют командлеты **CsHealthMonitoringConfiguration** для подготовки тестовых пользователей для каждого из пулов регистраторов. Данные тестовые пользователи — это пара пользователей, настроенных для использования в искусственных транзакциях (обычно это тестовые учетные записи, не принадлежащие настоящим пользователям). Подготовив тестовые учетные записи пользователей для пула, администраторы могут выполнить искусственную транзакцию для пула без необходимости указывать удостоверения (и учетные данные) учетных записей, задействованных в тесте.

Кроме того, администраторы могут выполнять искусственные транзакции с помощью учетных записей реальных пользователей. Например, если два пользователя не могут обмениваться мгновенными сообщениями, администратор может выполнить искусственную транзакцию с использованием учетных записей этих двух пользователей (вместо пары тестовых учетных записей), а затем попытаться найти и устранить проблему. При использовании реальных учетных записей для каждого из пользователей нужно будет указать имя для входа и пароль.

**Test-CsP2PAV** используется для определения того, могут ли два тестовых пользователя участвовать в одноранговой аудио-видео беседе. Для тестирования этого сценария командлет осуществляет вход двух пользователей в Lync Server. Предположим, что вход обоих пользователей выполнен успешно, а первый пользователь приглашает второго пользователя в аудио-видео беседу. Второй пользователь принимает приглашение, проверяется подключение между двумя пользователями, а затем вызов завершается, а тестовые пользователи выходят из системы.

**Test-CsP2PAV** не осуществляет аудио-видео вызов. Данные мультимедиа не передаются между тестовыми пользователями. Вместо этого командлет просто проверяет, можно ли установить соответствующие подключения и могут ли два пользователя выполнить такой вызов.

Чтобы получить список всех ролей управления доступом на основе ролей (RBAC), которым назначен этот командлет (включая все самостоятельно созданные роли RBAC), выполните в командной строке Windows PowerShell следующую команду:

Get-CsAdminRole | Where-Object {$\_.Cmdlets –match "Test-CsP2PAV"}

## Параметры


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Параметр</th>
<th>Обязательный</th>
<th>Тип</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><em>ReceiverCredential</em></p></td>
<td><p>Обязательный</p></td>
<td><p>PSCredential</p></td>
<td><p>Объект учетных данных пользователя для первой из двух учетных записей пользователей, которые должны тестироваться. Значение, переданное в ReceiverCredential, должно быть ссылкой на объект, полученной с помощью командлета <strong>Get-Credential</strong>. Например, следующий код возвращает объект учетных данных для пользователя litwareinc\pilar и сохраняет этот объект в переменной с именем $y:</p>
<p>$y = Get-Credential &quot;litwareinc\pilar&quot;</p>
<p>При запуске этой команды необходимо указать пароль пользователя.</p>
<p>Учетные данные получателя не требуются, если тест выполняется с параметрами конфигурации наблюдения за работоспособностью пула.</p></td>
</tr>
<tr class="even">
<td><p><em>SenderCredential</em></p></td>
<td><p>Обязательный</p></td>
<td><p>PSCredential</p></td>
<td><p>Объект учетных данных пользователя для второго из двух учетных записей пользователей, которые должны тестироваться. Значение, переданное в SenderCredential, должно быть ссылкой на объект, полученной с помощью командлета <strong>Get-Credential</strong>. Например, следующий код возвращает объект учетных данных для пользователя litwareinc\kenmyer и сохраняет этот объект в переменной с именем $x:</p>
<p>$x = Get-Credential &quot;litwareinc\kenmyer&quot;</p>
<p>При запуске этой команды необходимо указать пароль пользователя.</p>
<p>Учетные данные отправителя не требуются, если тест выполняется с параметрами конфигурации наблюдения за работоспособностью для пула.</p></td>
</tr>
<tr class="odd">
<td><p><em>TargetFqdn</em></p></td>
<td><p>Обязательный</p></td>
<td><p>String</p></td>
<td><p>Полное доменное имя пула, который должен тестироваться.</p></td>
</tr>
<tr class="even">
<td><p><em>Authentication</em></p></td>
<td><p>Необязательный</p></td>
<td><p>SipSyntheticTransaction AuthenticationMechanism</p></td>
<td><p>Тип проверки подлинности, используемой в тесте. Разрешенные значения:</p>
<p>* TrustedServer</p>
<p>* Negotiate</p>
<p>* ClientCertificate</p>
<p>* LiveID</p></td>
</tr>
<tr class="odd">
<td><p><em>Force</em></p></td>
<td><p>Необязательный</p></td>
<td><p>SwitchParameter</p></td>
<td><p>Подавляет отображение любых сообщений о некритических ошибках, которые могут возникать при выполнении этой команды.</p></td>
</tr>
<tr class="even">
<td><p><em>OutLoggerVariable</em></p></td>
<td><p>Необязательный</p></td>
<td><p>String</p></td>
<td><p>Если этот параметр используется, подробные результаты выполнения командлета будут сохранены в указанной переменной. Эта переменная включает в себя пару методов, ToHTML и ToXML, которые затем могут использоваться для сохранения этих результатов в HTML-файле или в XML-файле.</p>
<p>Для сохранения выходных результатов в переменной средства ведения журнала с именем $TestOutput используется следующий синтаксис:</p>
<p>-OutLoggerVariable TestOutput</p>
<p>Примечание. При указании имени переменной не следует добавлять в начало символ $. Чтобы сохранить информацию, содержащуюся в переменной средства ведения журнала, в HTML-файле, используйте команду, аналогичную следующей:</p>
<p>$TestOutput.ToHTML() &gt; C:\Logs\TestOutput.html</p>
<p>Чтобы сохранить информацию, содержащуюся в переменной средства ведения журнала, в XML-файле, используйте команду, аналогичную следующей:</p>
<p></p>
<p>$TestOutput.ToXML() &gt; C:\Logs\TestOutput.xml</p></td>
</tr>
<tr class="odd">
<td><p><em>OutVerboseVariable</em></p></td>
<td><p>Необязательный</p></td>
<td><p>String</p></td>
<td><p>При указании этого параметра подробные результаты выполнения командлета будут сохранены в указанной переменной. Например, чтобы сохранить результаты в переменную $TestOutput, используйте следующий синтаксис:</p>
<p>-OutVerboseVariable TestOutput</p>
<p>При указании имени переменной не следует добавлять в его начало символ $.</p></td>
</tr>
<tr class="even">
<td><p><em>ReceiverSipAddress</em></p></td>
<td><p>Необязательный</p></td>
<td><p>String</p></td>
<td><p>SIP-адрес для первой из двух учетных записей пользователей, которые должны тестироваться. Например: -ReceiverSipAddress &quot;sip:pilar@litwareinc.com&quot;. Параметр ReceiverSipAddress должен ссылаться на ту же учетную запись пользователя, что и параметр ReceiverCredential.</p>
<p>SIP-адрес не требуется, если тест выполняется с параметрами конфигурации наблюдения за работоспособностью для пула.</p></td>
</tr>
<tr class="odd">
<td><p><em>RegistrarPort</em></p></td>
<td><p>Необязательный</p></td>
<td><p>Int32</p></td>
<td><p>Порт SIP, используемый службой регистратора. Этот параметр не обязателен, если регистратор использует порт по умолчанию, 5061.</p></td>
</tr>
<tr class="even">
<td><p><em>SenderSipAddress</em></p></td>
<td><p>Необязательный</p></td>
<td><p>String</p></td>
<td><p>SIP-адрес для второй тестируемой учетной записи пользователя. Например: -SenderSipAddres &quot;sip:kenmyer@litwareinc.com&quot;. Параметр SenderSipAddress должен ссылаться на ту же учетную запись, что и SenderCredential.</p>
<p>SIP-адрес не требуется, если тест выполняется с параметрами конфигурации наблюдения за работоспособностью для пула.</p></td>
</tr>
</tbody>
</table>


## Типы входных данных

Нет. **Test-CsP2PAV** не принимает входные данные из конвейера.

## Типы возвращаемых данных

**Test-CsP2PAV** возвращает экземпляр объекта Microsoft.Rtc.SyntheticTransactions.TaskOutput.

## См. также

#### Другие ресурсы

[Test-CsAVConference](test-csavconference.md)

