---
title: Test-CsPstnPeerToPeerCall
TOCTitle: Test-CsPstnPeerToPeerCall
ms:assetid: 839cf83f-b667-4cbe-b1ab-28f54a8a9d0b
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Gg398662(v=OCS.15)
ms:contentKeyID: 49310364
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Test-CsPstnPeerToPeerCall

 

_**Дата изменения раздела:** 2015-03-09_

Тестирует способность пары пользователей выполнить одноранговый звонок через шлюз телефонной сети общего пользования (PSTN). Данный командлет впервые появился в Lync Server 2010.

## Синтаксис

    Test-CsPstnPeerToPeerCall -ReceiverCredential <PSCredential> -ReceiverSipAddress <String> -SenderCredential <PSCredential> -SenderSipAddress <String> [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] [-RegistrarPort <Int32>] [-TargetFqdn <String>] <COMMON PARAMETERS>

    Test-CsPstnPeerToPeerCall -TargetFqdn <String> [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] [-ReceiverSipAddress <String>] [-RegistrarPort <Int32>] [-SenderSipAddress <String>] <COMMON PARAMETERS>

    Test-CsPstnPeerToPeerCall [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] <COMMON PARAMETERS>

    COMMON PARAMETERS: [-Force <SwitchParameter>] [-OutLoggerVariable <String>] [-OutVerboseVariable <String>]

## Примеры

## ПРИМЕР 1

В примере 1 проверяется, может ли пара предварительно настроенных тестовых пользователей выполнить вход в пул atl-cs-001.litwareinc.com; после проведения теста пользователи выполняют вход в систему, а командлет **Test-CsPstnPeerToPeerCall** проверяет, могут ли два этих пользователя выполнить одноранговый звонок через шлюз ТСОП. Эта команда работает только в том случае, если тестовые пользователи были определены для пула atl-cs-001.litwareinc.com. Если это условие соблюдено, то команда определяет, может ли первый тестовый пользователь выполнить вход в систему, а затем проверяет, может ли этот пользователь позвонить второму определенному в пуле пользователю.

Если же тестовые пользователи не были определены, то команда завершается с ошибкой, так как она не знает, каких пользователей использовать при тестировании. Если вы не определили тестовых пользователей для пула и работаете в режиме, отличном от платформы сервера, то вам следует включить параметры SenderSipAddress и ReceiverSipAddress и соответствующие учетные данные для пользователей, выступающих в роли тестовых учетных записей. После этого командлет **Test-CsPstnPeerToPeerCall** выполняет проверки с использованием двух указанных пользователей.

    Test-CsPstnPeerToPeerCall -TargetFqdn atl-cs-001.litwareinc.com 

## ПРИМЕР 2

Команды, приведенные в примере 2, тестируют возможность пары пользователей (litwareinc\\pilar и litwareinc\\kenmyer) выполнить вход в Lync Server, а затем выполняют одноранговый звонок через шлюз PSTN. В этих целях первая команда в данном примере использует командлет **Get-Credential** для создания объекта учетных данных Windows PowerShell, содержащего имя и пароль для пользователя Pilar Ackerman. (Поскольку имя для входа — litwareinc\\pilar — было включено в качестве параметра, в диалоговом окне запроса учетных данных Windows PowerShell администратору требуется ввести только пароль для учетной записи Pilar Ackerman.) Полученный объект учетных данных сохраняется в переменной $cred1. Вторая команда производит аналогичную операцию, возвращая объект учетных данных для учетной записи Ken Myer.

При наличии двух объектов учетных данных третья команда в данном примере определяет, могут ли два этих пользователя выполнить вход в Lync Server, а затем выполнить одноранговый звонок через шлюз ТСОП. В этих целях выполняется вызов командлета **Test-CsPstnPeerToPeerCall** со следующими параметрами: TargetFqdn (полное доменное имя пула регистратора), SenderSipAddress (SIP-адрес для первого тестового пользователя), SenderCredential (объект Windows PowerShell, содержащий учетные данные для первого пользователя), ReceiverSipAddress (SIP-адрес для другого тестового пользователя) и ReceiverCredential (объект Windows PowerShell, содержащий учетные данные для другого пользователя).

    $cred1 = Get-Credential "litwareinc\pilar"
    $cred2 = Get-Credential "litwareinc\kenmyer"
    
    Test-CsPstnPeerToPeerCall -TargetFqdn atl-cs-001.litwareinc.com -SenderSipAddress "sip:jhaas@litwareinc.com" -SenderCredential $cred1 -ReceiverSipAddress "sip:kenmyer@litwareinc.com" -ReceiverCredential $cred2

## ПРИМЕР 3

В примере 3 показано, как можно использовать командлет Test-CsPstnPeerToPeerCall в режиме платформы сервера. В этом режиме указываются SIP-адреса тестовых пользователей, но не включаются учетные данные пользователей. При работе в этом режиме для проверки подлинности двух тестовых пользователей Lync Server использует сертификаты.

    Test-CsPstnPeerToPeerCall -TargetFqdn atl-cs-001.litwareinc.com -SenderSipAddress "sip:jhaas@litwareinc.com" -ReceiverSipAddress "sip:kenmyer@litwareinc.com" 

## Подробное описание

Командлет **Test-CsPstnPeerToPeerCall** представляет собой пример "искусственной транзакции" Lync Server. Искусственные транзакции используются в Lync Server для проверки того, что пользователи смогут успешно выполнять обычные задачи, такие как вход в систему, обмен мгновенными сообщениями или звонок на телефон, находящийся в телефонной сети общего пользования (ТСОП). Эти тесты могут проводиться как вручную администратором, так и автоматически такими приложениями, как Microsoft System Center Operations Manager (ранее Microsoft Operations Manager).

Искусственные транзакции обычно выполняются двумя разными способами. Многие администраторы используют командлеты **CsHealthMonitoringConfiguration** для подготовки тестовых пользователей для каждого из пулов регистраторов. Данные тестовые пользователи — это пара пользователей, настроенных для использования в искусственных транзакциях (обычно это тестовые учетные записи, не принадлежащие настоящим пользователям). Подготовив тестовые учетные записи пользователей для пула, администраторы могут выполнить искусственную транзакцию для пула без необходимости указывать удостоверения (и учетные данные) учетных записей, задействованных в тесте.

Кроме того, администраторы могут выполнять искусственные транзакции с помощью учетных записей реальных пользователей. Например, если два пользователя не могут обмениваться мгновенными сообщениями, администратор может выполнить искусственную транзакцию с использованием учетных записей этих двух пользователей (вместо пары тестовых учетных записей), а затем попытаться найти и устранить проблему. При использовании реальных учетных записей для каждого из пользователей нужно будет указать имя для входа и пароль.

Командлет **Test-CsPstnPeerToPeerCall** также можно использовать в режиме платформы сервера. В этом случае вам необходимо указать только SIP-адрес пользователей, и Lync Server будет использовать сертификаты для проверки подлинности этих пользователей.

При вызове командлета **Test-CsPstnPeerToPeerCall** он сначала пытается выполнить для двух тестовых пользователей вход в Lync Server. При успешном входе в рамках выполнения командлета пользователь 1 пытается позвонить пользователю 2 через шлюз ТСОП. Командлет **Test-CsPstnPeerToPeerCall** осуществляет этот звонок с использованием абонентской группы, политики голосовой связи и других параметров политик и конфигураций, назначенных этому тестовому пользователю. Если тест проходит как запланировано, командлет подтверждает, что пользователь 2 смог ответить на этот звонок, а затем выполняет выход из системы для обеих тестовых учетных записей.

Командлет **Test-CsPstnPeerToPeerCall** выполняет реальный телефонный звонок, который подтверждает, что установка соединения возможна, а также передает по сети коды DTMF, чтобы определить, позволяет ли это соединение передавать данные мультимедиа. Однако на звонок отвечает сам командлет, поэтому ручное завершение звонка не требуется. (То есть никому не требуется поднимать и затем вешать трубку на телефоне, на который выполнялся звонок.)

Чтобы получить список всех ролей управления доступом на основе ролей (RBAC), которым назначен этот командлет (включая все самостоятельно созданные роли RBAC), выполните в командной строке Windows PowerShell следующую команду:

Get-CsAdminRole | Where-Object {$\_.Cmdlets –match "Test-CsPstnPeerToPeerCall"}

## Параметры


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Параметр</th>
<th>Обязательный</th>
<th>Тип</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><em>ReceiverCredential</em></p></td>
<td><p>Обязательный</p></td>
<td><p>PSCredential</p></td>
<td><p>Объект учетных данных пользователя для первой из двух учетных записей пользователей, которые должны тестироваться. Значение, переданное в ReceiverCredential, должно быть ссылкой на объект, полученной с помощью командлета <strong>Get-Credential</strong>. Например, следующий код возвращает объект учетных данных для пользователя litwareinc\pilar и сохраняет этот объект в переменной с именем $y:</p>
<p>$y = Get-Credential &quot;litwareinc\pilar&quot;</p>
<p>При запуске этой команды необходимо указать пароль пользователя.</p>
<p>Учетные данные получателя не требуются, если тест выполняется с параметрами конфигурации наблюдения за работоспособностью пула или если вы работаете в режиме платформы сервера.</p></td>
</tr>
<tr class="even">
<td><p><em>SenderCredential</em></p></td>
<td><p>Обязательный</p></td>
<td><p>PSCredential</p></td>
<td><p>Объект учетных данных пользователя для второго из двух учетных записей пользователей, которые должны тестироваться. Значение, переданное в SenderCredential, должно быть ссылкой на объект, полученной с помощью командлета <strong>Get-Credential</strong>. Например, следующий код возвращает объект учетных данных для пользователя litwareinc\kenmyer и сохраняет этот объект в переменной с именем $x:</p>
<p>$x = Get-Credential &quot;litwareinc\kenmyer&quot;</p>
<p>При запуске этой команды необходимо указать пароль пользователя.</p>
<p>Учетные данные отправителя не требуются, если вы проводите данное тестирование для пула с использованием параметров конфигурации наблюдения за работоспособностью системы или работаете в режиме платформы сервера.</p></td>
</tr>
<tr class="odd">
<td><p><em>TargetFqdn</em></p></td>
<td><p>Обязательный</p></td>
<td><p>String</p></td>
<td><p>Полное доменное имя пула, который должен тестироваться.</p></td>
</tr>
<tr class="even">
<td><p><em>Authentication</em></p></td>
<td><p>Необязательный</p></td>
<td><p>SipSyntheticTransaction AuthenticationMechanism</p></td>
<td><p>Тип проверки подлинности, используемой в тесте. Разрешенные значения:</p>
<p>* TrustedServer</p>
<p>* Negotiate</p>
<p>* ClientCertificate</p>
<p>* LiveID</p></td>
</tr>
<tr class="odd">
<td><p><em>Force</em></p></td>
<td><p>Необязательный</p></td>
<td><p>SwitchParameter</p></td>
<td><p>Подавляет отображение любых сообщений о некритических ошибках, которые могут возникать при выполнении этой команды.</p></td>
</tr>
<tr class="even">
<td><p><em>OutLoggerVariable</em></p></td>
<td><p>Необязательный</p></td>
<td><p>String</p></td>
<td><p>Если этот параметр используется, подробные результаты выполнения командлета будут сохранены в указанной переменной. Эта переменная включает в себя пару методов, ToHTML и ToXML, которые затем могут использоваться для сохранения этих результатов в HTML-файле или в XML-файле.</p>
<p>Для сохранения выходных результатов в переменной средства ведения журнала с именем $TestOutput используется следующий синтаксис:</p>
<p>-OutLoggerVariable TestOutput</p>
<p>Примечание. При указании имени переменной не следует добавлять в начало символ $. Чтобы сохранить информацию, содержащуюся в переменной средства ведения журнала, в HTML-файле, используйте команду, аналогичную следующей:</p>
<p>$TestOutput.ToHTML() &gt; C:\Logs\TestOutput.html</p>
<p>Чтобы сохранить информацию, содержащуюся в переменной средства ведения журнала, в XML-файле, используйте команду, аналогичную следующей:</p>
<p></p>
<p>$TestOutput.ToXML() &gt; C:\Logs\TestOutput.xml</p></td>
</tr>
<tr class="odd">
<td><p><em>OutVerboseVariable</em></p></td>
<td><p>Необязательный</p></td>
<td><p>String</p></td>
<td><p>При указании этого параметра подробные результаты выполнения командлета будут сохранены в указанной переменной. Например, чтобы сохранить результаты в переменную $TestOutput, используйте следующий синтаксис:</p>
<p>-OutVerboseVariable TestOutput</p>
<p>При указании имени переменной не следует добавлять в его начало символ $.</p></td>
</tr>
<tr class="even">
<td><p><em>ReceiverSipAddress</em></p></td>
<td><p>Необязательный</p></td>
<td><p>String</p></td>
<td><p>SIP-адрес для первой из двух учетных записей пользователей, которые должны тестироваться. Например: -ReceiverSipAddress &quot;sip:pilar@litwareinc.com&quot;. Параметр ReceiverSipAddress должен ссылаться на ту же учетную запись пользователя, что и параметр ReceiverCredential.</p>
<p>SIP-адрес не требуется, если тест выполняется с параметрами конфигурации наблюдения за работоспособностью для пула.</p></td>
</tr>
<tr class="odd">
<td><p><em>RegistrarPort</em></p></td>
<td><p>Необязательный</p></td>
<td><p>Int32</p></td>
<td><p>Порт SIP, используемый службой регистратора. Этот параметр не обязателен, если регистратор использует порт по умолчанию, 5061.</p></td>
</tr>
<tr class="even">
<td><p><em>SenderSipAddress</em></p></td>
<td><p>Необязательный</p></td>
<td><p>String</p></td>
<td><p>SIP-адрес для второй из двух учетных записей пользователей, которые должны тестироваться. Например: -SenderSipAddress &quot;sip:kenmyer@litwareinc.com&quot;. Параметр SenderSipAddress должен ссылаться на ту же учетную запись пользователя, что и параметр SenderCredential.</p>
<p>SIP-адрес не требуется, если тест выполняется с параметрами конфигурации наблюдения за работоспособностью для пула.</p></td>
</tr>
</tbody>
</table>


## Типы входных данных

Нет. Командлет **Test-CsPstnPeerToPeerCall** не принимает входные данные из конвейера.

## Типы возвращаемых данных

Командлет **Test-CsPstnPeerToPeerCall** возвращает экземпляр объекта Microsoft.Rtc.SyntheticTransactions.TaskOutput.

## См. также

#### Другие ресурсы

[Test-CsPstnOutboundCall](test-cspstnoutboundcall.md)

