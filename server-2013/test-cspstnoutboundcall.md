---
title: Test-CsPstnOutboundCall
TOCTitle: Test-CsPstnOutboundCall
ms:assetid: 12d940c3-8526-4c8f-8dc1-3fe65a3211bc
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Gg398207(v=OCS.15)
ms:contentKeyID: 49309005
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Test-CsPstnOutboundCall

 

_**Дата изменения раздела:** 2015-03-09_

Проверяет, может ли пользователь осуществлять телефонные звонки в телефонной сети общего пользования (PSTN). Данный командлет впервые появился в Lync Server 2010.

## Синтаксис

    Test-CsPstnOutboundCall -TargetPstnPhoneNumber <String> -UserCredential <PSCredential> -UserSipAddress <String> [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] [-RegistrarPort <Int32>] [-TargetFqdn <String>] <COMMON PARAMETERS>

    Test-CsPstnOutboundCall -TargetFqdn <String> -TargetPstnPhoneNumber <String> [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] [-RegistrarPort <Int32>] [-UserSipAddress <String>] <COMMON PARAMETERS>

    Test-CsPstnOutboundCall [-Authentication <TrustedServer | Negotiate | ClientCertificate | LiveID>] <COMMON PARAMETERS>

    COMMON PARAMETERS: [-Force <SwitchParameter>] [-OutLoggerVariable <String>] [-OutVerboseVariable <String>]

## Примеры

## ПРИМЕР 1

Пример 1 проверяет, может ли предварительно настроенный тестовый пользователь войти в пул atl-cs-001.litwareinc.com и осуществить телефонный звонок через шлюз PSTN. Эта команда будет работать, только если для пула atl-cs-001.litwareinc.com были определены тестовые пользователи. В этом случае команда определит, может ли первый тестовый пользователь войти в систему и выполнить телефонный звонок в сети общего пользования.

Если тестовые пользователи не заданы, команда завершится ошибкой, так как не сможет определить, какого пользователя использовать при проверке. Если вы не определили тестовых пользователей для пула, укажите учетную запись пользователя для выполнения проверки с помощью параметра UserSipAddress. Тогда при выполнении проверок командлет **Test-CsPstnOutboundCall** будет использовать указанного пользователя.

    Test-CsPstnOutboundCall -TargetFqdn atl-cs-001.litwareinc.com -TargetPstnPhoneNumber "+15551234567" 

## ПРИМЕР 2

В примере 2 показаны команды, которые проверяют возможность тестового пользователя (litwareinc\\kenmyer) выполнить вход в Lync Server и осуществить телефонный звонок через шлюз PSTN. Для этого в первой команде используется командлет **Get-Credential** для создания объекта учетных данных Windows PowerShell, содержащего имя и пароль пользователя Ken Myer. (Поскольку имя входа litwareinc\\kenmyer включено в качестве параметра, администратор должен ввести в диалоговом окне запроса учетных данных Windows PowerShell только пароль для учетной записи Ken Myer.) После этого результирующий объект учетных данных сохраняется в переменной $cred1.

Используя полученный объект учетных данных, вторая команда определяет, может ли тестовый пользователь войти в Lync Server и осуществить телефонный звонок по заданному номеру (+15551234567). Для выполнения этой задачи вызывается командлет **Test-CsPstnOutboundCall** со следующими параметрами: TargetFqdn (полное доменное имя пула Registrar); UserSipAddress (SIP-адрес пользователя, осуществляющего звонок); UserCredential (объект Windows PowerShell, содержащий учетные данные тестового пользователя); TargetPstnPhoneNumber (набираемый номер телефона).

    $cred1 = Get-Credential "litwareinc\kenmyer"
    
    Test-CsPstnOutboundCall -TargetFqdn atl-cs-001.litwareinc.com -TargetPstnPhoneNumber "+15551234567" -UserSipAddress "sip:kenmyer@litwareinc.com" -UserCredential $cred1

## ПРИМЕР 3

В примере 3 показано использование командлета **Test-CsPstnOutboundCall** в режиме платформы сервера. В этом режиме SIP-адрес пользователя указывается, но учетные данные не включаются. При таком выполнении Lync Server использует для проверки подлинности тестового пользователя сертификаты.

    Test-CsPstnOutboundCall -TargetFqdn atl-cs-001.litwareinc.com -UserSipAddress sip:kenmyer@litwareinc.com -TargetPstnPhoneNumber "+15551234567"

## Подробное описание

Командлет **Test-CsPstnOutboundCall** является примером "искусственной транзакции" Lync Server. Искусственные транзакции используются в Lync Server для проверки возможности успешного выполнения пользователями таких действий, как выполнение входа, отправка мгновенных сообщений, выполнение звонков на номер стандартной телефонной сети (PSTN). Подобные тесты могут быть проведены вручную администратором или же автоматически с помощью приложения, подобного Microsoft System Center Operations Manager (ранее Microsoft Operations Manager).

Обычно искусственные транзакции выполняются двумя разными способами. Многие администраторы применяют командлеты **CsHealthMonitoringConfiguration**, чтобы задать тестовых пользователей для каждого из своих пулов Registrar. Тестовые пользователи представляют собой пару пользователей, предварительно настроенных для применения с искусственными транзакциями. (Обычно это тестовые учетные записи, не принадлежащие реальным пользователям.) С помощью настроенных для пула тестовых пользователей администраторы могут легко запускать искусственную транзакцию в рамках пула без необходимости указывать идентификаторы (и предоставлять учетные данные) для применяемых в тесте пользовательских учетных записей.

При другом подходе администраторы могут выполнять искусственные транзакции с использованием действующих учетных записей пользователей. Например, если два пользователя не могут обмениваться мгновенными сообщениями, администратор может выполнить искусственную транзакцию, используя учетные записи этих пользователей (вместо пары тестовых учетных записей), чтобы определить и устранить проблему. При выполнении искусственной транзакции с использованием действующих учетных записей необходимо указать имена и пароли соответствующих пользователей.

Командлет Test-CsPstnOutboundCall также можно использовать в режиме платформы сервера. В этом случае необходимо указать только SIP-адрес пользователя, а для проверки подлинности Lync Server будет использовать сертификаты.

Командлет **Test-CsPstnOutboundCall** сначала пытается выполнить вход в Lync Server от имени тестового пользователя. Если вход выполнен успешно, командлет пытается осуществить телефонный звонок через шлюз PSTN. Этот звонок выполняется с использованием абонентской группы, политики голосовой службы и других политик и параметров, назначенных для тестовой учетной записи. После ответа на вызов командлет отправляет по сети коды DTMF для проверки соединения.

При проведении этой проверки командлет **Test-CsPstnOutboundCall** осуществляет реальный телефонный звонок: для успешного выполнения проверки целевой телефон должен принять вызов и ответить на него. Администратор должен завершить этот вызов вручную.

Кто может запускать данный командлет: чтобы получить список всех ролей управления доступом на основе ролей (RBAC), которые были назначены для этого командлета (включая все созданные вами роли RBAC), запустите следующую команду из командной строки Windows PowerShell:

Get-CsAdminRole | Where-Object {$\_.Cmdlets –match "Test-CsPstnOutboundCall"}

## Параметры


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Параметр</th>
<th>Обязательный?</th>
<th>Тип</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><em>TargetFqdn</em></p></td>
<td><p>Обязательный</p></td>
<td><p>Строка</p></td>
<td><p>Полное доменное имя (FQDN) тестируемого пула.</p></td>
</tr>
<tr class="even">
<td><p><em>TargetPstnPhoneNumber</em></p></td>
<td><p>Обязательный</p></td>
<td><p>Строка</p></td>
<td><p>Номер телефона PSTN, который будет вызван при проведении проверки. Целевой номер телефона лучше всего указывать в формате E.164, т. е. в виде &quot;+14255551298&quot; — со знаком &quot;плюс&quot; (+), за которым следует код страны/региона (1), код зоны (425) и номер телефона (5551298). При указании номера телефона не используйте тире, скобки и другие символы.</p>
<p>Если формат E.164 не используется, к номеру будет добавлена абонентская группа тестового пользователя. Lync Server будет использовать абонентскую группу для нормализации номера в формат E.164. Если нормализовать номер не удастся, вызов не будет выполнен и проверка завершится ошибкой.</p></td>
</tr>
<tr class="odd">
<td><p><em>UserCredential</em></p></td>
<td><p>Обязательный</p></td>
<td><p>PSCredential</p></td>
<td><p>Объект учетных данных пользователя для тестируемой учетной записи. Значение, передаваемое для UserCredential, должно быть ссылкой на объект, полученной с помощью командлета <strong>Get-Credential</strong>. Например, следующий код возвращает объект учетных данных для пользователя litwareinc\kenmyer и сохраняет его в переменной $x:</p>
<p>$x = Get-Credential &quot;litwareinc\kenmyer&quot;</p>
<p>При выполнении данной команды требуется указать пароль пользователя.</p>
<p>Этот параметр не нужен, если в команде используются тестовые пользователи, настроенные с помощью командлетов CsHealthMonitoringConfiguration. Этот параметр также не нужно указывать, если проверка проводится в режиме платформы сервера. В этом случае Lync Server попытается выполнить проверку подлинности пользователя с помощью сертификатов.</p></td>
</tr>
<tr class="even">
<td><p><em>Authentication</em></p></td>
<td><p>Необязательный</p></td>
<td><p>SipSyntheticTransaction AuthenticationMechanism</p></td>
<td><p>Тип проверки подлинности, используемой в тесте. Допустимые значения:</p>
<p>* TrustedServer</p>
<p>* Negotiate</p>
<p>* ClientCertificate</p>
<p>* LiveID</p></td>
</tr>
<tr class="odd">
<td><p><em>Force</em></p></td>
<td><p>Необязательный</p></td>
<td><p>SwitchParameter</p></td>
<td><p>Запрещает на время выполнения команды отображение каких-либо сообщений о некритических ошибках.</p></td>
</tr>
<tr class="even">
<td><p><em>OutLoggerVariable</em></p></td>
<td><p>Необязательный</p></td>
<td><p>System.String</p></td>
<td><p>При указании переменной подробный отчет о выполнении командлета будет записан в эту переменную. Данная переменная содержит пару методов, ToHTML и ToXML, с помощью которых отчет может быть сохранен в HTML- или XML-файл.</p>
<p>Чтобы сохранить результаты в переменную средства ведения журнала с именем $TestOutput, используется следующий синтаксис:</p>
<p>-OutLoggerVariable TestOutput</p>
<p>Примечание. Не добавляйте символ $ к указываемому имени переменной. Для записи данных, хранимых в переменной средства ведения журнала, в HTML-файл используйте следующую команду:</p>
<p>$TestOutput.ToHTML() &gt; C:\Logs\TestOutput.html</p>
<p>Чтобы записать в XML-файл данные, хранящиеся в переменной средства ведения журнала, используйте следующую команду:</p>
<p></p>
<p>$TestOutput.ToXML() &gt; C:\Logs\TestOutput.xml</p></td>
</tr>
<tr class="odd">
<td><p><em>OutVerboseVariable</em></p></td>
<td><p>Необязательный</p></td>
<td><p>Строка</p></td>
<td><p>При указании переменной подробный отчет о выполнении командлета будет записан в эту переменную. Например, чтобы сохранить выходные данные в переменную под названием $TestOutput, используйте следующий синтаксис:</p>
<p>-OutVerboseVariable TestOutput</p>
<p>При указании имени переменной не добавляйте к нему символ $.</p></td>
</tr>
<tr class="even">
<td><p><em>RegistrarPort</em></p></td>
<td><p>Необязательный</p></td>
<td><p>Int32</p></td>
<td><p>SIP-порт, используемый службой Registrar. Указание данного параметра не требуется, если служба регистратора использует стандартный порт 5061.</p></td>
</tr>
<tr class="odd">
<td><p><em>UserSipAddress</em></p></td>
<td><p>Необязательный</p></td>
<td><p>Строка</p></td>
<td><p>SIP-адрес для тестируемой учетной записи пользователя. Например: -SenderSipAddress &quot;sip:kenmyer@litwareinc.com&quot;. Параметр UserSipAddress должен ссылаться на ту же учетную запись, что и UserCredential.</p>
<p>Этот параметр не нужен, если в команде используются тестовые пользователи, настроенные с помощью командлетов CsHealthMonitoringConfiguration.</p></td>
</tr>
</tbody>
</table>


## Типы входных данных

Нет. Командлет **Test-CsPstnOutboundCall** не принимает конвейерные входные данные.

## Типы возвращаемых данных

Командлет **Test-CsPstnOutboundCall** возвращает экземпляр объекта Microsoft.Rtc.SyntheticTransactions.TaskOutput.

## См. также

#### Другие ресурсы

[Test-CsPstnPeerToPeerCall](test-cspstnpeertopeercall.md)

